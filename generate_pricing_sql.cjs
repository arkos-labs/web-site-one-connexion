
const fs = require('fs');
const path = require('path');

// Helper to mimic the TS structure
const t = (n, e, u) => ({
    n, e, u, vn: n * 2, ve: n * 3
});

const data = [
    { ville: "Alfortville", cp: "94140", f: t(6, 10, 14) },
    { ville: "Antony", cp: "92160", f: t(8, 12, 16) },
    { ville: "Arcueil", cp: "94110", f: t(4, 7, 10) },
    { ville: "Argenteuil", cp: "95100", f: t(8, 12, 16) },
    { ville: "Arpajon", cp: "91290", f: t(15, 20, 25) },
    { ville: "Asnières sur Seine", cp: "92600", f: t(4, 7, 10) },
    { ville: "Athis Mons", cp: "91200", f: t(12, 17, 22) },
    { ville: "Aubervilliers", cp: "93300", f: t(4, 7, 10) },
    { ville: "Aulnay sous Bois", cp: "93600", f: t(12, 17, 22) },
    { ville: "Bagneux", cp: "92220", f: t(4, 7, 10) },
    { ville: "Bagnolet", cp: "93170", f: t(4, 7, 10) },
    { ville: "Bezons", cp: "95870", f: t(8, 12, 16) },
    { ville: "Bièvres", cp: "91570", f: t(12, 17, 22) },
    { ville: "Blanc Mesnil (le)", cp: "93150", f: t(8, 12, 16) },
    { ville: "Bobigny", cp: "93000", f: t(6, 10, 14) },
    { ville: "Bois Colombes", cp: "92270", f: t(4, 7, 10) },
    { ville: "Bois d'Arcy", cp: "78390", f: t(14, 19, 24) },
    { ville: "Bondoufle", cp: "91070", f: t(15, 20, 25) },
    { ville: "Bondy", cp: "93140", f: t(8, 12, 16) },
    { ville: "Bonneuil sur Marne", cp: "94380", f: t(12, 17, 22) },
    { ville: "Bougival", cp: "78380", f: t(8, 12, 16) },
    { ville: "Boulogne Billancourt", cp: "92100", f: t(3, 6, 9) },
    { ville: "Bourg la Reine", cp: "92340", f: t(8, 12, 16) },
    { ville: "Bourget (le)", cp: "93350", f: t(8, 12, 16) },
    { ville: "Brie Comte Robert", cp: "77170", f: t(20, 25, 30) },
    { ville: "Bry sur Marne", cp: "94360", f: t(8, 12, 16) },
    { ville: "Buc", cp: "78530", f: t(8, 12, 16) },
    { ville: "Bussy Saint Georges", cp: "77600", f: t(14, 19, 24) },
    { ville: "Cachan", cp: "94230", f: t(4, 7, 10) },
    { ville: "Carrières sur Seine", cp: "78420", f: t(8, 12, 16) },
    { ville: "Cergy", cp: "95800", f: t(15, 20, 25) },
    { ville: "Champigny sur Marne", cp: "94500", f: t(8, 12, 16) },
    { ville: "Champs sur Marne", cp: "77420", f: t(14, 19, 24) },
    { ville: "Charenton le Pont", cp: "94220", f: t(4, 7, 10) },
    { ville: "Châtenay Malabry", cp: "92290", f: t(8, 12, 16) },
    { ville: "Châtillon", cp: "92320", f: t(4, 7, 10) },
    { ville: "Chatou", cp: "78400", f: t(8, 12, 16) },
    { ville: "Chaville", cp: "92370", f: t(7, 11, 15) },
    { ville: "Chelles", cp: "77500", f: t(14, 19, 24) },
    { ville: "Chennevières sur Marne", cp: "94430", f: t(12, 17, 22) },
    { ville: "Chesnay Rocquencourt (le)", cp: "78150", f: t(8, 12, 16) },
    { ville: "Chessy", cp: "77700", f: t(20, 25, 30) },
    { ville: "Chevilly Larue", cp: "94550", f: t(8, 12, 16) },
    { ville: "Chilly Mazarin", cp: "91380", f: t(12, 17, 22) },
    { ville: "Choisy le Roi", cp: "94600", f: t(8, 12, 16) },
    { ville: "Clamart", cp: "92140", f: t(4, 7, 10) },
    { ville: "Clichy", cp: "92110", f: t(3, 6, 9) },
    { ville: "Clichy sous Bois", cp: "93390", f: t(14, 19, 24) },
    { ville: "Colombes", cp: "92700", f: t(4, 7, 10) },
    { ville: "Combs la Ville", cp: "77380", f: t(18, 23, 28) },
    { ville: "Conflans Ste Honorine", cp: "78700", f: t(15, 20, 25) },
    { ville: "Coubron", cp: "93470", f: t(14, 19, 24) },
    { ville: "Coulommiers", cp: "77120", f: t(30, 35, 40) },
    { ville: "Courbevoie", cp: "92400", f: t(3, 6, 9) },
    { ville: "Courcouronnes", cp: "91080", f: t(15, 20, 25) },
    { ville: "Courneuve (la)", cp: "93120", f: t(6, 10, 14) },
    { ville: "Créteil", cp: "94000", f: t(8, 12, 16) },
    { ville: "Croissy Beaubourg", cp: "77183", f: t(14, 19, 24) },
    { ville: "Défense (la)", cp: "92060", f: t(3, 6, 9) },
    { ville: "Deuil la Barre", cp: "95170", f: t(10, 15, 20) },
    { ville: "Domont", cp: "95330", f: t(14, 19, 24) },
    { ville: "Drancy", cp: "93700", f: t(8, 12, 16) },
    { ville: "Dugny", cp: "93440", f: t(8, 12, 16) },
    { ville: "Elancourt", cp: "78990", f: t(14, 19, 24) },
    { ville: "Emerainville", cp: "77184", f: t(14, 19, 24) },
    { ville: "Enghien les Bains", cp: "95880", f: t(10, 15, 20) },
    { ville: "Epinay sur Seine", cp: "93800", f: t(6, 10, 14) },
    { ville: "Étampes", cp: "91150", f: t(25, 30, 35) },
    { ville: "Evry", cp: "91000", f: t(15, 20, 25) },
    { ville: "Fontainebleau", cp: "77300", f: t(30, 35, 40) },
    { ville: "Fontenay aux Roses", cp: "92260", f: t(4, 7, 10) },
    { ville: "Fontenay sous Bois", cp: "94120", f: t(6, 10, 14) },
    { ville: "Fourqueux", cp: "78112", f: t(10, 15, 20) },
    { ville: "Franconville la Garenne", cp: "95130", f: t(10, 15, 20) },
    { ville: "Fresnes", cp: "94260", f: t(8, 12, 16) },
    { ville: "Gagny", cp: "93220", f: t(12, 17, 22) },
    { ville: "Garches", cp: "92380", f: t(4, 7, 10) },
    { ville: "Garenne Colombes (la)", cp: "92250", f: t(4, 7, 10) },
    { ville: "Garges les Gonesse", cp: "95140", f: t(10, 15, 20) },
    { ville: "Gennevilliers", cp: "92230", f: t(4, 7, 10) },
    { ville: "Gentilly", cp: "94250", f: t(4, 7, 10) },
    { ville: "Gif sur Yvette", cp: "91190", f: t(15, 20, 25) },
    { ville: "Gometz le Châtel", cp: "91940", f: t(15, 20, 25) },
    { ville: "Gonesse", cp: "95000", f: t(10, 15, 20) },
    { ville: "Gournay sur Marne", cp: "93460", f: t(14, 19, 24) },
    { ville: "Goussainville", cp: "95190", f: t(14, 19, 24) },
    { ville: "Guyancourt", cp: "78280", f: t(14, 19, 24) },
    { ville: "Hay les Roses (l')", cp: "94240", f: t(6, 10, 14) },
    { ville: "Herblay", cp: "95220", f: t(15, 20, 25) },
    { ville: "Houilles", cp: "78800", f: t(8, 12, 16) },
    { ville: "Iles Saint Denis (l')", cp: "93450", f: t(6, 10, 14) },
    { ville: "Issy les Moulineaux", cp: "92130", f: t(3, 6, 9) },
    { ville: "Ivry sur Seine", cp: "94200", f: t(4, 7, 10) },
    { ville: "Joinville le Pont", cp: "94340", f: t(6, 10, 14) },
    { ville: "Jouy en Josas", cp: "78350", f: t(8, 12, 16) },
    { ville: "Juvisy sur Orge", cp: "91260", f: t(12, 17, 22) },
    { ville: "Kremlin Bicêtre (le)", cp: "94250", f: t(4, 7, 10) },
    { ville: "La Queue-en-Brie", cp: "94510", f: t(14, 19, 24) },
    { ville: "Levallois Perret", cp: "92300", f: t(3, 6, 9) },
    { ville: "Lieusaint", cp: "77127", f: t(18, 23, 28) },
    { ville: "Lilas (les)", cp: "93260", f: t(4, 7, 10) },
    { ville: "Limeil Brevannes", cp: "94450", f: t(12, 17, 22) },
    { ville: "Lisses", cp: "91090", f: t(15, 20, 25) },
    { ville: "Livry Gargan", cp: "93190", f: t(14, 19, 24) },
    { ville: "Lognes", cp: "77185", f: t(14, 19, 24) },
    { ville: "Longjumeau", cp: "91160", f: t(12, 17, 22) },
    { ville: "Louveciennes", cp: "78430", f: t(8, 12, 16) },
    { ville: "Maisons Alfort", cp: "94700", f: t(6, 10, 14) },
    { ville: "Maisons Laffite", cp: "78600", f: t(10, 15, 20) },
    { ville: "Malakoff", cp: "92240", f: t(3, 6, 9) },
    { ville: "Mantes la Jolie", cp: "78200", f: t(25, 30, 35) },
    { ville: "Marly le Roi", cp: "78160", f: t(8, 12, 16) },
    { ville: "Marnes la Coquette", cp: "92430", f: t(7, 11, 15) },
    { ville: "Massy", cp: "91300", f: t(12, 17, 22) },
    { ville: "Meaux", cp: "77100", f: t(25, 30, 35) },
    { ville: "Melun", cp: "77000", f: t(25, 30, 35) },
    { ville: "Meudon", cp: "92190", f: t(4, 7, 10) },
    { ville: "Meudon La Forêt", cp: "92390", f: t(7, 11, 15) },
    { ville: "Meulan en Yvelines", cp: "78250", f: t(20, 25, 30) },
    { ville: "Mitry Mory", cp: "77290", f: t(14, 19, 24) },
    { ville: "Moissy Cramayel", cp: "77550", f: t(18, 23, 28) },
    { ville: "Monfermeil", cp: "93370", f: t(14, 19, 24) },
    { ville: "Montfort l'Amaury", cp: "78490", f: t(20, 23, 27) },
    { ville: "Montigny le Bretonneux", cp: "78180", f: t(14, 19, 24) },
    { ville: "Montlhéry", cp: "91310", f: t(15, 20, 25) },
    { ville: "Montreuil sous Bois", cp: "93100", f: t(4, 7, 10) },
    { ville: "Montrouge", cp: "92120", f: t(3, 6, 9) },
    { ville: "Morangis", cp: "91420", f: t(12, 17, 22) },
    { ville: "Mureaux (les)", cp: "78130", f: t(20, 25, 30) },
    { ville: "Nanterre", cp: "92000", f: t(4, 7, 10) },
    { ville: "Neuilly Plaisance", cp: "93360", f: t(12, 17, 22) },
    { ville: "Neuilly sur Marne", cp: "93330", f: t(12, 17, 22) },
    { ville: "Neuilly sur Seine", cp: "92200", f: t(3, 6, 9) },
    { ville: "Nogent sur Marne", cp: "94130", f: t(6, 10, 14) },
    { ville: "Noiseau", cp: "94370", f: t(12, 17, 22) },
    { ville: "Noisy le Grand", cp: "93160", f: t(12, 17, 22) },
    { ville: "Noisy le Sec", cp: "93130", f: t(6, 10, 14) },
    { ville: "Orly", cp: "94310", f: t(8, 12, 16) },
    { ville: "Ormesson sur Marne", cp: "94490", f: t(12, 17, 22) },
    { ville: "Orsay", cp: "91400", f: t(15, 20, 25) },
    { ville: "Palaiseau", cp: "91120", f: t(12, 17, 22) },
    { ville: "Pantin", cp: "93500", f: t(4, 7, 10) },
    { ville: "Paris 01", cp: "75001", f: t(2, 4, 7) },
    { ville: "Paris 02", cp: "75002", f: t(2, 4, 7) },
    { ville: "Paris 03", cp: "75003", f: t(3, 6, 9) },
    { ville: "Paris 04", cp: "75004", f: t(3, 6, 9) },
    { ville: "Paris 05", cp: "75005", f: t(3, 6, 9) },
    { ville: "Paris 06", cp: "75006", f: t(3, 6, 9) },
    { ville: "Paris 07", cp: "75007", f: t(2, 4, 7) },
    { ville: "Paris 08", cp: "75008", f: t(2, 4, 7) },
    { ville: "Paris 09", cp: "75009", f: t(2, 4, 7) },
    { ville: "Paris 10", cp: "75010", f: t(3, 6, 9) },
    { ville: "Paris 11", cp: "75011", f: t(3, 6, 9) },
    { ville: "Paris 12", cp: "75012", f: t(3, 6, 9) },
    { ville: "Paris 13", cp: "75013", f: t(3, 6, 9) },
    { ville: "Paris 14", cp: "75014", f: t(3, 6, 9) },
    { ville: "Paris 15", cp: "75015", f: t(2, 4, 7) },
    { ville: "Paris 16", cp: "75016", f: t(2, 4, 7) },
    { ville: "Paris 17", cp: "75017", f: t(2, 4, 7) },
    { ville: "Paris 18", cp: "75018", f: t(3, 6, 9) },
    { ville: "Paris 19", cp: "75019", f: t(3, 6, 9) },
    { ville: "Paris 20", cp: "75020", f: t(3, 6, 9) },
    { ville: "Pavillons sous Bois (les)", cp: "93320", f: t(12, 17, 22) },
    { ville: "Perreux sur Marne (le)", cp: "94170", f: t(8, 12, 16) },
    { ville: "Pierrefitte sur Seine", cp: "93380", f: t(8, 12, 16) },
    { ville: "Plaisir", cp: "78370", f: t(14, 19, 24) },
    { ville: "Plessis Robinson (le)", cp: "92350", f: t(8, 12, 16) },
    { ville: "Plessis Trévise (le)", cp: "94420", f: t(14, 19, 24) },
    { ville: "Poissy", cp: "78300", f: t(15, 20, 25) },
    { ville: "Pontoise", cp: "95300", f: t(15, 20, 25) },
    { ville: "Pré Saint Gervais (le)", cp: "93310", f: t(4, 7, 10) },
    { ville: "Puteaux", cp: "92800", f: t(3, 6, 9) },
    { ville: "Raincy (le)", cp: "93340", f: t(12, 17, 22) },
    { ville: "Rambouillet", cp: "78120", f: t(25, 30, 35) },
    { ville: "Roissy en France", cp: "95700", f: t(14, 19, 24) },
    { ville: "Romainville", cp: "93230", f: t(6, 10, 14) },
    { ville: "Rosny sous Bois", cp: "93110", f: t(6, 10, 14) },
    { ville: "Rueil Malmaison", cp: "92500", f: t(4, 7, 10) },
    { ville: "Rungis", cp: "94150", f: t(8, 12, 16) },
    { ville: "Saclay", cp: "91400", f: t(15, 20, 25) },
    { ville: "Saint Cloud", cp: "92210", f: t(4, 7, 10) },
    { ville: "Saint Denis (la plaine)", cp: "93210", f: t(4, 7, 10) },
    { ville: "Saint Denis (nord)", cp: "93200", f: t(6, 10, 14) },
    { ville: "Saint Germain en Laye", cp: "78100", f: t(10, 15, 20) },
    { ville: "Saint Gratien", cp: "95210", f: t(10, 15, 20) },
    { ville: "Saint Mandé", cp: "94160", f: t(4, 7, 10) },
    { ville: "Saint Maur des Fossés", cp: "94210", f: t(8, 12, 16) },
    { ville: "Saint Maurice", cp: "94410", f: t(6, 10, 14) },
    { ville: "Saint Ouen l'Aumône", cp: "95310", f: t(15, 20, 25) },
    { ville: "Saint Ouen sur Seine", cp: "93400", f: t(4, 7, 10) },
    { ville: "Saint Thibault des Vignes", cp: "77400", f: t(16, 21, 26) },
    { ville: "Sarcelles", cp: "95200", f: t(10, 15, 20) },
    { ville: "Sartrouville", cp: "78500", f: t(8, 12, 16) },
    { ville: "Sceaux", cp: "92330", f: t(8, 12, 16) },
    { ville: "Sevran", cp: "93270", f: t(14, 19, 24) },
    { ville: "Sèvres", cp: "92310", f: t(4, 7, 10) },
    { ville: "Stains", cp: "93240", f: t(8, 12, 16) },
    { ville: "Sucy en Brie", cp: "94370", f: t(12, 17, 22) },
    { ville: "Suresnes", cp: "92150", f: t(3, 6, 9) },
    { ville: "Thiais", cp: "94320", f: t(8, 12, 16) },
    { ville: "Torcy", cp: "77200", f: t(14, 19, 24) },
    { ville: "Trappes", cp: "78190", f: t(14, 19, 24) },
    { ville: "Tremblay en France", cp: "93290", f: t(14, 19, 24) },
    { ville: "Ulis (les)", cp: "91940", f: t(15, 20, 25) },
    { ville: "Valenton", cp: "94460", f: t(12, 17, 22) },
    { ville: "Vanves", cp: "92170", f: t(3, 6, 9) },
    { ville: "Vaucresson", cp: "92420", f: t(7, 11, 15) },
    { ville: "Vaujours", cp: "93410", f: t(14, 19, 24) },
    { ville: "Vélizy Villacoublay", cp: "78140", f: t(8, 12, 16) },
    { ville: "Versailles", cp: "78000", f: t(8, 12, 16) },
    { ville: "Vesinet (le)", cp: "78110", f: t(8, 12, 16) },
    { ville: "Ville d'Avray", cp: "92410", f: t(7, 11, 15) },
    { ville: "Villecresnes", cp: "94440", f: t(14, 19, 24) },
    { ville: "Villejuif", cp: "94800", f: t(6, 10, 14) },
    { ville: "Villemomble", cp: "93250", f: t(8, 12, 16) },
    { ville: "Villeneuve la Garenne", cp: "92390", f: t(6, 10, 14) },
    { ville: "Villeneuve St Georges", cp: "94190", f: t(12, 17, 22) },
    { ville: "Villepinte", cp: "93420", f: t(14, 19, 24) },
    { ville: "Villetaneuse", cp: "93430", f: t(8, 12, 16) },
    { ville: "Villiers sur Marne", cp: "94350", f: t(8, 12, 16) },
    { ville: "Vincennes", cp: "94300", f: t(4, 7, 10) },
    { ville: "Viroflay", cp: "78220", f: t(8, 12, 16) },
    { ville: "Vitry sur Seine", cp: "94400", f: t(6, 10, 14) },
    { ville: "Voisins le Bretonneux", cp: "78960", f: t(14, 19, 24) },
    { ville: "Wissous", cp: "91320", f: t(10, 15, 20) },
];

let sql = `
-- Script de migration généré automatiquement
-- Met à jour les prix pour correspondre aux données locales (tarifs_idf.ts)

BEGIN;

CREATE TEMP TABLE pricing_updates (
    city_name text,
    zip_code text,
    price_normal numeric,
    price_express numeric,
    price_urgence numeric,
    price_vl_normal numeric,
    price_vl_express numeric
);

INSERT INTO pricing_updates (city_name, zip_code, price_normal, price_express, price_urgence, price_vl_normal, price_vl_express) VALUES
`;

const values = data.map(item => {
    return `('${item.ville.replace(/'/g, "''")}', '${item.cp}', ${item.f.n}, ${item.f.e}, ${item.f.u}, ${item.f.vn}, ${item.f.ve})`;
}).join(',\n');

sql += values + `;\n\n`;

sql += `
INSERT INTO city_pricing (city_name, zip_code, price_normal, price_express, price_urgence, price_vl_normal, price_vl_express)
SELECT 
    pu.city_name, 
    pu.zip_code, 
    pu.price_normal, 
    pu.price_express, 
    pu.price_urgence, 
    pu.price_vl_normal, 
    pu.price_vl_express
FROM pricing_updates pu
ON CONFLICT (city_name, zip_code) 
DO UPDATE SET
    price_normal = EXCLUDED.price_normal,
    price_express = EXCLUDED.price_express,
    price_urgence = EXCLUDED.price_urgence,
    price_vl_normal = EXCLUDED.price_vl_normal,
    price_vl_express = EXCLUDED.price_vl_express,
    updated_at = NOW();

COMMIT;
`;

fs.writeFileSync(path.join(__dirname, 'full_migration.sql'), sql, 'utf8');
console.log("Migration file written to full_migration.sql");
